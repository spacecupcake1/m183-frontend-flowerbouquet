<div class="admin-container">
  <!-- Header -->
  <div class="admin-header">
    <h1>Admin - Flower Management</h1>
    <div class="header-buttons">
      <button mat-button (click)="goBack()">‚Üê Back to Main</button>
      <button mat-button (click)="logout()">Logout</button>
    </div>
  </div>

  <!-- Stats Section -->
  <div class="stats-section" *ngIf="stats">
    <h2>Statistics</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <h3>{{ stats.totalFlowers }}</h3>
        <p>Total Flowers</p>
      </div>
      <div class="stat-card">
        <h3>{{ stats.availableFlowers }}</h3>
        <p>Available</p>
      </div>
      <div class="stat-card">
        <h3>{{ stats.unavailableFlowers }}</h3>
        <p>Unavailable</p>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="action-section">
    <button mat-raised-button color="primary" (click)="startCreating()"
            [disabled]="isEditing || isCreating">
      + Create New Flower
    </button>
  </div>

  <!-- Create/Edit Form -->
  <div class="form-section" *ngIf="isCreating || isEditing">
    <div class="form-container">
      <h2>{{ isCreating ? 'Create New Flower' : 'Edit Flower' }}</h2>

      <form class="flower-form">
        <div class="form-row">
          <mat-form-field appearance="fill">
            <mat-label>Name</mat-label>
            <input matInput [(ngModel)]="editingFlower.name" name="name" required>
            <mat-error *ngIf="hasError('name')">{{ getError('name') }}</mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Color</mat-label>
            <input matInput [(ngModel)]="editingFlower.color" name="color" required>
            <mat-error *ngIf="hasError('color')">{{ getError('color') }}</mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="fill">
            <mat-label>Price</mat-label>
            <input matInput type="number" [(ngModel)]="editingFlower.price" name="price" required min="0">
            <mat-error *ngIf="hasError('price')">{{ getError('price') }}</mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Availability</mat-label>
            <mat-select [(ngModel)]="editingFlower.availablity" name="availablity" required>
              <mat-option value="Available">Available</mat-option>
              <mat-option value="Unavailable">Unavailable</mat-option>
            </mat-select>
            <mat-error *ngIf="hasError('availablity')">{{ getError('availablity') }}</mat-error>
          </mat-form-field>
        </div>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Meaning</mat-label>
          <textarea matInput [(ngModel)]="editingFlower.meaning" name="meaning" required rows="2"></textarea>
          <mat-error *ngIf="hasError('meaning')">{{ getError('meaning') }}</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Information</mat-label>
          <textarea matInput [(ngModel)]="editingFlower.info" name="info" required rows="3"></textarea>
          <mat-error *ngIf="hasError('info')">{{ getError('info') }}</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Image URL</mat-label>
          <input matInput [(ngModel)]="editingFlower.imageUrl" name="imageUrl" required>
          <mat-error *ngIf="hasError('imageUrl')">{{ getError('imageUrl') }}</mat-error>
        </mat-form-field>

        <div class="form-buttons">
          <button mat-raised-button color="primary" type="button"
                  (click)="isCreating ? createFlower() : updateFlower()">
            {{ isCreating ? 'Create Flower' : 'Update Flower' }}
          </button>
          <button mat-button type="button"
                  (click)="isCreating ? cancelCreate() : cancelEdit()">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Flowers List -->
  <div class="flowers-section">
    <h2>All Flowers ({{ flowers.length }})</h2>

    <div class="flowers-table-container">
      <table mat-table [dataSource]="flowers" class="flowers-table">
        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>ID</th>
          <td mat-cell *matCellDef="let flower">{{ flower.id }}</td>
        </ng-container>

        <!-- Image Column -->
        <ng-container matColumnDef="image">
          <th mat-header-cell *matHeaderCellDef>Image</th>
          <td mat-cell *matCellDef="let flower">
            <img [src]="'/assets' + flower.imageUrl" [alt]="flower.name" class="flower-thumbnail">
          </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Name</th>
          <td mat-cell *matCellDef="let flower">{{ flower.name }}</td>
        </ng-container>

        <!-- Color Column -->
        <ng-container matColumnDef="color">
          <th mat-header-cell *matHeaderCellDef>Color</th>
          <td mat-cell *matCellDef="let flower">{{ flower.color }}</td>
        </ng-container>

        <!-- Price Column -->
        <ng-container matColumnDef="price">
          <th mat-header-cell *matHeaderCellDef>Price</th>
          <td mat-cell *matCellDef="let flower">{{ flower.price | currency:'EUR':'symbol':'1.2-2' }}</td>
        </ng-container>

        <!-- Availability Column -->
        <ng-container matColumnDef="availability">
          <th mat-header-cell *matHeaderCellDef>Availability</th>
          <td mat-cell *matCellDef="let flower">
            <span class="availability-badge"
                  [class.available]="flower.availablity === 'Available'"
                  [class.unavailable]="flower.availablity === 'Unavailable'">
              {{ flower.availablity }}
            </span>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let flower">
            <button mat-icon-button color="primary"
                    (click)="startEditing(flower)"
                    [disabled]="isEditing || isCreating"
                    matTooltip="Edit">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn"
                    (click)="deleteFlower(flower)"
                    [disabled]="isEditing || isCreating"
                    matTooltip="Delete">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="['id', 'image', 'name', 'color', 'price', 'availability', 'actions']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['id', 'image', 'name', 'color', 'price', 'availability', 'actions'];"></tr>
      </table>
    </div>

    <div *ngIf="flowers.length === 0" class="no-flowers">
      <p>No flowers found. Create your first flower!</p>
    </div>
  </div>
</div>
